# Provable Oracles

Система проверяемых оракулов для блокчейн приложений, позволяющая использовать внешние данные без необходимости постоянно отправлять их в блокчейн.

## Архитектура системы

Система состоит из двух основных смарт-контрактов:

1. **OracleVerifier** - контракт для проверки подписанных сообщений от доверенных оракулов
2. **AssetTradingWithQuotes** - демонстрация практического применения

### Принцип работы

1. Доверенные оракулы подписывают сообщения офф-чейн
2. Пользователи получают подписанные сообщения через API
3. Пользователи отправляют хеш сообщения с подписями в смарт-контракты
4. Контракты проверяют подписи и генерируют события

Такой подход позволяет экономить газ, так как данные не нужно постоянно записывать в блокчейн.

## Контракт OracleVerifier

Этот контракт проверяет, что сообщения подписаны достаточным количеством доверенных оракулов.

### Ключевые функции

- `addOracle(address oracle)` - добавляет доверенный адрес оракула
- `removeOracle(address oracle)` - удаляет адрес из списка доверенных оракулов
- `setMaxQuoteAge(uint256 _maxQuoteAge)` - устанавливает максимальное время жизни сообщения в секундах
- `verify(string calldata data, bytes[] calldata signatures, uint256 timestamp)` - проверяет подписи сообщения

### Механизм проверки сообщений

- Контракт имеет список доверенных оракулов
- Рассчитывается порог подписей (n/2+1, где n - количество оракулов)
- Для проверки сообщения требуется предоставить не менее порогового количества подписей от доверенных оракулов

## Контракт AssetTradingWithQuotes

Этот демонстрационный контракт использует OracleVerifier для проверки сообщений и генерации событий.

### Ключевые функции

- `processPrice(string calldata data, uint256 timestamp, bytes[] calldata signatures)` - проверяет подписи сообщения и генерирует события

### События

- `PriceVerified(address indexed user, bytes32 messageHash)` - генерируется при успешной проверке сообщения
- `PriceRejected(address indexed user, bytes32 messageHash)` - генерируется при неуспешной проверке сообщения

## Требования для развертывания

- Node.js v16+ и npm
- Аккаунт в сети Siberium с нативной валютой
- Приватный ключ аккаунта для деплоя

## Настройка окружения

1. Установите зависимости:
   ```
   npm install
   ```

2. Создайте файл `.env` и добавьте в него:
   ```
   RPC_URL=https://rpc.test.siberium.net
   PRIVATE_KEY=ваш_приватный_ключ_без_0x
   ```

## Деплой


1. Деплой контрактов:
   ```
   npx hardhat run scripts/deploy.js --network siberium
   ```

2. Добавление оракулов:
   ```
   npx hardhat run scripts/add-multiple-oracles.js
   ```
